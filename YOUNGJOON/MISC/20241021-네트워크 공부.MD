> 해당 게시물은 고재성님, 이상훈님의 "IT 엔지니어를 위한 네트워크 입문" 교재를 보고 작성한 게시글 입니다.

# 0. 들어가기 전에
> 이번 장에서는 네트워크 통신 과정에서 필요한 MAC 주소, IP 주소에 대해 알아보고, 주소 체계를 이루는 서브넷, 게이트웨이와 같은 용어와 ARP와 같은 프로토콜의 기능과 역할에 대해 알아보자!

# 1. 유니캐스트, 멀티캐스트, 브로드캐스트, 애니캐스트

> 네트워크에서 출발지에서 목적지로 데이터를 전송할 때 사용하는 통신 방식의 종류로 **유니캐스트(Unicast), 멀티캣트(Multicast), 브로드캐스트(Broadcast), 애니캐스트(Anycast)가 있다.**

## 1) 유니캐스트
> - 1 : 1 통신
- 출발지와 목적지가 1 : 1로 통신한다.

![](https://velog.velcdn.com/images/dudwns0202/post/b7ccde44-81db-4cc3-9e71-6cc186745b2f/image.png)


- 실제로 하는 대부분의 통신은 유니캐스트 방식


## 2) 브로드캐스트
> - 1 : 모든 통신
- 동일 네트워크에 존재하는 모든 호스트가 목적지

![](https://velog.velcdn.com/images/dudwns0202/post/89e2cfc2-fc94-46da-b040-89c219d72de0/image.png)

- 목적지 주소가 모든 곳으로 표기되어 있는 통신방식
- 주로 상대방의 정확한 위치를 알기 위해 사용
- 기본 동작은 로컬 네트워크 내에서 모든 호스트에 패킷을 전달해야 할 때 사용

## 3) 멀티캐스트
> - 1 : 그룹(멀티캐스트 구독 호스트) 통신
- 하나의 출발지에서 다수의 특정 목적지로 데이터 전송

![](https://velog.velcdn.com/images/dudwns0202/post/61c965fb-c8b0-4627-9d65-8762d76c1256/image.png)


- 멀티캐스트 그룹 주소를 이용해 해당 그룹에 속한 다수의 호스트로 패킷을 전송하기 위한 통신 방식
- IPTV와 같은 실시간 방송이나 사내 방송, 증권 시세 전송과 같이 단뱡향으로 다수에게 동시에 같은 내용을 전달할 때 사용됨


## 4) 애니캐스트
> - 1 : 1 통신(목적지는 동일 그룹 내의 1개 호스트)
- 다수의 동일 그룹 중 가장 가까운 호스트에서 응답
- IPv4에서는 일부 기능 구현, Ipv6에서는 모두 구현 가능

![](https://velog.velcdn.com/images/dudwns0202/post/5430e3d1-3059-40c5-b915-87466297ef31/image.png)

- **애니캐스트 주소가 같은 호스트들 중에서 가장 가깝거나 가장 효율적으로 서비스할 수 있는 호스트와 통신하는 방식**이다.
- 이러한 애니캐스트 게이트웨이의 성질을 이용하여 가장 가까운 DNS 서버나 게이트웨이를 찾을 때 사용한다.
- 1 : 1 통신으로 유니캐스트와 동일하지만, 통신할 수 있는 후보자가 서로 다르다

## 5) 유니캐스트와 애니캐스트의 차이
### 유니캐스트
- 출발지와 목적지가 모두 한 대씩

### 애니캐스트
- 같은 목적지 주소를 가진 서버가 여러 대여서 통신 가능한 다수의 후보군이 있음

## 6) 정리
- 현재 주로 사용되는 네트워크 주소 체계는 **IPv4** 기반이다.
- 일부 모바일 네트워크와 대규모 데이터 센터 위주로 새로운 **IPv6** 기반 주소 체계가 사용되고 있다.
  - IPv6에서는 브로드캐스트가 존재하지 않고 **링크 로컬 멀티캐스트로** 대체되어 사용된다.
  
| 타입         | 통신 대상 | 범위                  | IPv4 | IPv6 | 예제          |
| :----------- | :-------- | :-------------------- | :--- | :--- | :------------ |
| 유니캐스트   | 1 : 1     | 전체 네트워크         | ○    | ○    | HTTP          |
| 브로드캐스트 | 1 : 모든  | 서브넷(로컬 네트워크) | ○    | X    | ARP           |
| 멀티캐스트   | 1 : 그룹  | 정의된 구간           | ○    | ○    | 방송          |
| 애니캐스트   | 1 : 1     | 전체 네트워크         | △    | ○    | 6 to 4<br>DNS |

### 팁!
- 이런 통신 방식을 구분할 때 중요한 점은 **실제 데이터를 전달하려는 출발지가 기준이 아니라 *목적지 주소*를 기준**으로 구분한다는 것이다.

## 7) BUM 트래픽
> **BUM = Broadcast, Unknown Unicast, Multicast**

- BUM은 서로 다른 정류의 트래픽이지만, 네트워크에서의 동작은 서로 비슷하다.
- 이더넷 환경에서는 ARP 브로드캐스트를 먼저 보내고 이후 통신을 시작하므로 BUM 트래픽이 많이 발생하지 않는다.

### 언노운 유니캐스트


- **유니캐스트여서 목적지 주소는 명확히 명시**되어 있지만, **네트워크에서의 동작은 브로드캐스트와 같을 때**를 가리킨다.
  - 목적지가 명확히 명시되어 있지만, 스위치가 **목적지에 대한 주소를 학습하지 못한 상황**이어서 **패킷을 모든 포트로 플러딩(전송)**하는데 이런 유니캐스트를 **언노운 유니캐스트**라고 한다.
- 모든 단말 NIC에서 목적지를 확인하면 결국 잘못 보낸것은 버려지긴하지만 계속해서 언노운 유니캐스트가 발생하면 **네트워크 성능이 떨어질 수 있다.**


# 2. MAC 주소
> MAC : Media Access Control
- 2계층에서 통신을 위해 네트워크 인터페이스에 할당된 고유 식별자
- 대부분의 IEEE 802 네트워크 기술에서 2계층 주소로 사용됨

## 1) MAC 주소 체계
> MAC 주소는 변경할 수 없도록 하드웨어에 고정되어 출하되므로 네트워크 구성 요소마다 다른 주소를 가지고 있다.

- 그럼 하드웨어를 출하하다가 MAC 주소가 겹치면 어떻게 해요?
  - 이를 방지하기 위해서 각 제조업체에 주소의 풀을 주고 그 풀안에서 MAC 주소를 자체적으로 할당한다.
  - 이렇게 주소 풀을 할당하는 것을 **제조사 코드(Vebdor Code)**라고 부르며 이 주소는 **국제기구인 IEEE가 관리**한다.
- MAC 주소는 네트워크 장비 제조업체 코드와 제조업체가 자체적으로 할당한 값으로 구성된다.
  - 네트워크 카드나 장비를 생산할 때 하드웨어적으로 정해져 나오므로 MAC 주소를 **'BIA(Burned-In Address)**라고도 한다.
  
### MAC 주소의 표현
> MAC 주소는 48비트의 16진수 12자리로 표현된다.
> 48비트의 MAC 주소는 다시 24비트씩 앞뒤로 나누어 구분한다.

#### 24비트로 나눈 앞 주소
> 제조사 코드로써 **'OUI'** 라고 한다.

#### 24비트로 나눈 뒷 주소
> 제조사에서 자체적으로 할당하는 주소로써 **'UAA'**라고 한다.


### 유일하지 않는 MAC 주소
- 위에서 언급한 것을 보면 MAC 주소는 유일하겠구나 싶을 수 있지만, 사실 아닐수도 있다.
- 헉 그러면 중복되면 큰일나는 것 아닌가요?
  - 동일 네트워크에서 중복되지만 않으면 괜찮다!
    - 네트워크 통신 시 네트워크가 달라 라우터의 도움을 받는 경우, 라우터에서 **다른 네트워크로 넘겨줄 때 출발지와 도착지의 MAC 주소가 변경되므로 네트워크를 넘어가면 기존 출발지와 도착지 MAC 주소를 유지하지 않는다.**
    
### MAC 주소 변경
- MAC 주소는 **BIA 상태로 NIC*에 할당되어 있고 일반적으로 ROM 형태로 고정되어 출하하므로** 변경하기는 어려우나 사실 가능은 하다.
- MAC 주소도 결국 메모리에 적재되어 구동되므로 여러 방법을 이용해 변경된 MAC 주소로 NIC를 구동할 수 있다.
- 그러나 보안상의 이유로 막아놓은 운영체제도 있다!

> NIC = Network Interface Card: 네트워크 인터페이스 카드


## 2) MAC 주소 동작
> **NIC는 자신의 MAC주소를 가지고 있고 전기 신호가 들어오면 2계층에서 데이터 형태(패킷)로 변환하여 내용을 구분한 후 도착지 MAC 주소를 확인한다.** 이 때, 자신의 MAC 주소와 맞고 브로드캐스트, 멀티캐스트와 같은 그룹 주소이면 상위 계층으로 넘기고, 아니라면 폐기한다.

- 그러나 MAC 주소는 NIC가 확인하지만, 브로드캐스트, 멀티캐스트 주소는 NIC에서 처리하는 것이 아닌 **OS나 애플리케이션에서 처리해야 하므로** 시스템에 부하가 작용한다.
- **브로드캐스트 스톰**이 이와 연관성이 있다.
  - 브로드캐스트가 회선을 모두 채우게 되어 네트워크에 연결된 모든 단말이 브로드캐스트를 처리하느라 CPU 사용량이 증가하는 현상
  
  
### 무차별 모드(Promiscuous Mode)
- 평소에는 NIC가 MAC 주소를 확인하고 자신의 MAC 주소와 다르면 패킷을 폐기하지만, 네트워크 상태를 모니터링하거나, 디버그, 분석 용도로 네트워크 전체 패킷을 수집해야 할 경우에는 NIC가 이것들을 폐기시켜버리면 안된다.
- 이를 해결하기 위해 NIC를 **무차별 모드**로 구성한다.
  - 무차별 모드로 구성되면 자신의 MAC 주소와 상관없는 패킷이 들어와도 이를 분석할 수 있도록 메모리에 올려 처리하게 해준다.
- 대표적인 예시로 와이어샤크(WireShark)가 있다.


### MAC 주소를 여러개 갖는 경우
- MAC 주소는 NIC에 종속되기 때문에, 단말이 NIC를 여러개 가지면 MAC 주소도 여러개 가질 수 있다.
- 멀티레이어 스위치, 라우터와 같은 복잡한 네트워크 장비는 NIC가 여러 개이고 MAC 주소도 여러 개를 갖는다.


### MAC 주소로 제조업체 찾기
- MAC 주소의 **'OUI'**를 IEEE 홈페이지에서 검색하면 확인 가능


# 3. IP 주소
> IP 주소를 포함한 **다른 프로토콜 스택의 3계층 주소**는 다음과 같은 특징이 있다.
1. 사용자가 변경 가능한 논리 주소이다.
2. 주소에 레벨이 있다. 그룹을 의미하는 네트워크 주소와 호스트 주소로 나뉜다.

## 1) IP 주소 체계
> **흔히 사용하는 IP 주소는 32비트인 IPv4 주소이다.**
> IP는 v4, v6 두 체계가 사용되며 **IPv6 주소는 128비트이다.**

![](https://velog.velcdn.com/images/dudwns0202/post/b194eb43-114a-4b70-85be-efa2d22ae9c4/image.png)


-  IPv4 주소를 표기할 때는 **4개의 옥텟(Octet)**이라고 부르는 8비트 단위로 나누고 각 옥텟은 "." 으로 구분한다.
- 2계층의 MAC 주소가 16진수로 표기된 것과 달리 IP주소는 **10진수로 표기**하므로 8비트 옥텟은 **0~255의 값을 쓸 수 있다.**
- IP 주소도 MAC 주소 처럼 **"네트워크 주소"와 "호스트 주소"** 두 부분으로 나뉜다!
  - 근데 똑같은 목적으로 나누는 것은 아니다! 이건 염두해두자
  - **MAC 주소 처럼 두 부분으로 나누는 경계가 고정되어 있지 않다.**
  
### 네트워크 주소
- **호스트들을 모은 네트워크를 지칭하는 주소**, **네트워크 주소가 동일한 네트워크를 로컬 네트워크**라고 한다.

### 호스트 주소
- **하나의 네트워크 내에 존재하는 호스트를 구분하기 위한 주소**

### 서브넷 마스크
> **네트워크 주소와 호스트 주소를 나누는 구분자를 *서브넷 마스크*라고 한다!**

### 클래스

- IP 주소 체계는 **필요한 호스트 IP 개수에 따라 네트워크의 크기를 다르게 할당**할 수 있는 **클래스(Class) 개념**을 도입했다.
  - **A 클래스**
    - 가장 큰 주소를 가지며, 약 1,600만 개의 IP 주소를 가질 수 있다.
    - **첫 번째 옥텟**에 네트워크 주소와 호스트 주소를 나누는 **구분자가 있다.**
    - **네크워크 주소를 표현하는 부분이 1개의 옥텟**, **호스트 주소를 나타낼 수 있는 부분이 3개의 옥텟**을 가진다.
      - 네트워크의 개수 = 2^8(256)
      - 한 네트워크 당 호스트 주소 개수 = 2^24(16,777,216)
  - **B 클래스**
    - 약 6만 5천개의 IP 주소를 가질 수 있다.
    - 두번째 옥텟에 **구분자가 있다.**
    - **네크워크 주소를 표현하는 부분이 2개의 옥텟**, **호스트 주소를 나타낼 수 있는 부분이 2개의 옥텟**을 가진다.
      - 네트워크의 개수 = 2^16(65,536)
      - 한 네트워크 당 호스트 주소 개수 = 2^16(65,536)
  - **C 클래스**
    - 약 250개의 IP 주소를 가질 수 있다.
    - 세번째 옥텟에 **구분자가 있다.**
    - **네크워크 주소를 표현하는 부분이 3개의 옥텟**, **호스트 주소를 나타낼 수 있는 부분이 1개의 옥텟**을 가진다.
      - 네트워크의 개수 = 2^24(16,777,216)
      - 한 네트워크 당 호스트 주소 개수 = 2^8(256)

- IP 주소가 도입한 클래스 개념은 다른 고정된 네트워크 주소 체계에 비해 주소를 절약할 수 있다는 장점이 있다.
  - 고정된 주소 체계를 사용하면 큰 네트워크를 필요로 하는 조직은 네트워크를 여러개 확보해야하고, 작은 네트워크를 필요로 하는 조직은 낭비되는 IP가 생긴다.
    
### 각 클래스 구분하기
> A, B, C 클래스는 맨 앞 옥텟의 주소만 보고 구분할 수 있다!

- **A 클래스**
  - 앞 옥텟의 주소가 0~127 범위라면 A 클래스이다.
    - 즉, 첫 옥텟을 이진수로 표기했을 때 2진수 8자리 중 맨 앞자리가 0인 주소가 A 클래스이다. (00000000 ~ 01111111)
    - 127만 예외로 자신을 의미하는 **루프백(Loopback) 주소**로 사용되므로 실제로 A 클래스로 사용할 수 있는 주소는 아래같이 된다.
    ```
    1.0.0.0 ~ 127.0.0.0 (단, 127.0.0.0 은 로컬 호스트)
    ```

- **B 클래스**
  - 첫 옥텟을 2진수로 표기했을 때, 첫 번째 자리가 1이고 두 번째 자리가 0인 주소가 B 클래스이다. (10000000 ~ 10111111)
  - 실제로 B 클래스로 사용할 수 있는 주소는 아래같이 된다.
    ```
    128.0.0.0 ~ 191.0.0.0
    ```
  
- **C 클래스**
  - 첫 옥텟을 2진수로 표기했을 때, 첫 번째, 두 번째 자리가 1이고 세 번째 자리가 0인 주소가 B 클래스이다. (11000000 ~ 11011111)
    - 실제로 B 클래스로 사용할 수 있는 주소는 아래같이 된다.
    ```
    192.0.0.0 ~ 223.0.0.0
    ```
  
 - 클래스 기반의 네트워크 분할 기법은 과거에 사용했던 개념이고 요즘에는 1비트 단위로 네트워크를 상세히 분할하는 방법을 사용한다.


### 네트워크에서 사용 가능한 호스트 개수 파악하기
> IP 네트워크에서는 네트워크 크기가 변경되므로 하나의 네트워크에서 사용 가능한 호스트 개수와 사용 가능한 유효 IP 범위를 파악하는 것이 중요하다!

- 특히나 클래스 단위가 아닌 **클래스리스(Classless) 네트워크**인 경우에는 유효 IP 범위 파악이 매우 중요해진다.
- IP는 2진수로 나타내므로, 2^자릿수 형태로 표현할 수 있는 IP 숫자를 구할 수 있다.
  - A 클래스 = 2^24개
  - B 클래스 = 2^16개
  - C 클래스 = 2^8개
- 하지만, 실제로 IP 체계에서 **맨 앞의 숫자를 네트워크 주소로, 맨 뒤의 숫자를 브로드 캐스트 주소로 사용**하므로 실제로 사용할 수 있는 IP는 다음과 같다.
  - A 클래스 = 2^24 - 2개(16,777,214)
  - B 클래스 = 2^16 - 2개(65,534)
  - C 클래스 = 2^8 - 2개(254)

> 네트워크 주소: 172.16.0.0
> 브로드캐스트 주소: 172.16.255.255
> 유효 IP 범위: 172.16.0.1 ~ 172.16.255.254

- 위의 예시로 호스트 개수를 파악해보자
- 현재 주어진 네트워크 주소와, 브로드캐스트 주소는 해당 IP 범위에서 시작점과, 끝점이다.
- 172로 시작하므로 B 클래스이다.
  - 128~191 범위
- B클래스는 2^16 - 2개이므로 65,534개가 된다.


## 2) 클래스풀과 클래스리스
> **클래스풀(Classful)** = 클래스 기반의 IP 주소 체계
> **클래스리스** = 클래스가 아닌 **서브넷 마스크**를 이용하여 네트워크 주소와 호스트 주소를 나누는 IP 주소 체계

### ① 클래스리스 네트워크의 등장
> 클래스 기반으로 사용할 수 있는 IP 주소는 43억 여개 정도로 전 세계 인구가 1개씩도 못쓰는 적은 양이다. 이를 해결하기 위해 나타난 것 중 하나가 **클래스리스 IP 체계** 이다.

- IP 주소 부족과 낭비 문제를 해결하기 위해 3가지 보존, 전환 전략을 만들었다.
  - 단기 대책
    - **클래스리스**
    - CIDR(Classless Inter-Domain Routing)기반의 주소 체계
  - 중기 대책
    - NAT
    - 사설 IP 주소
  - 장기 대책
    - IPv6
    
### ② 서브넷 마스크**
> 서브넷 마스크는 클래스리스 네트워크에서 별도로 네트워크와 호스트 주소를 나누는 구분자를 뜻한다.

- 서브넷 마스크는 IP 주소와 네트워크 주소를 구분할 때 사용하는데 **2진수 숫자 1은 네트워크 주소, 0은 호스트 주소로 표시**하며 보통 10진수를 사용해 표현한다.
- 예시
  ```
  255.0.0.0, 255.255.0.0, 255.255.255.0
  ```
- 2진수 11111111을 10진수로 표현하면 255가 되어 네트워크 주소 부분, 0은 호스트 부분으로 구분된다.

#### 서브넷 마스크를 이용한 네트워크 주소 구하기
> 103.9.32.146 호스트 주소에
> 255.255.255.0 서브넷 마스크를 사용해보자!

- 103.9.32.146에 255.255.255.0을 두 값 모두 2진수로 하여 &&연산(and연산)을 진행한다. 이 결과값이 현재 주소의 네트워크 주소가 된다.
  - 네트워크 주소는 103.9.32.0이 된다.
  
  |           주소 종류            |  옥텟1   |  옥텟2   |  옥텟3   |  옥텟4   |
  | :----------------------------: | :------: | :------: | :------: | :------: |
  |  호스트 주소<br>103.9.32.146   | 01100111 | 00001001 | 00100000 | 10010010 |
  | 서브넷 마스크<br>255.255.255.0 | 11111111 | 11111111 | 11111111 | 00000000 |
  |          and연산 실행          |    &     |    &     |    &     |    &     |
  |  네트워크 주소<br>103.9.32.0   | 01100111 | 00001001 | 00100000 | 00000000 |

<br>

- **클래스리스 기반의 IP 네트워크**에서는 네트워크를 표현하는 데 **반드시 서브넷 마스크가 필요**하고 **서버나 PC에 IP 주소를 부여할 때도 사용**되어야 한다.

### ③ 서브넷 마스크 표현 방법
> 서브넷 마스크를 표현하는 방법은 비트 단위로 표현하는 방법과 10진수로 표현하는 방법이 있다.

- 8진수 or 16진수
  - 일부 네트워크 장비에서는 8진수나 16진수로 나타내지만 표현하거나 이해하기가 어려워 대부분 사용하지 않는다.
- **비트 단위로 표현하는 방법**
  - A 클래스 : /8
  - B 클래스 : /16
  - C 클래스 : /24
  - **"/" 이건 뭘까?**
    - **프리픽스 길이**를 나타내며 즉, IP주소에서 네트워크 부분이 차지하는 비트의 개수를 뜻한다.
    - A 클래스는 비트 8개를 사용(옥텟 1개)
  
- **10진수로 표현하는 방법**
  - A 클래스 : 255.0.0.0
  - B 클래스 : 255.255.0.0
  - C 클래스 : 255.255.255.0