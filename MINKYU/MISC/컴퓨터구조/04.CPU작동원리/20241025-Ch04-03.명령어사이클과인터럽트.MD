# 컴퓨터구조
## Ch04. CPU 작동 원리
### 04-03. 명령어 사이클과 인터럽트
출처 : [강민철 - 개발자를 위한 컴퓨터공학 1 : 혼자 공부하는 컴퓨터구조 + 운영체제](https://www.inflearn.com/course/%ED%98%BC%EC%9E%90-%EA%B3%B5%EB%B6%80%ED%95%98%EB%8A%94-%EC%BB%B4%ED%93%A8%ED%84%B0%EA%B5%AC%EC%A1%B0-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C)

### 1. 명령어 사이클
명령어 사이클(Instruction Cycle) : 프로그램 속 각 명령어들이 반복되면서 실행되는 일정한 주기
- 프로그램 속 명령어들은 명령어 사이클이 반복되어 실행된다
- 기본적인 명령어 사이클은 인출 <-> 실행

#### 인출 사이클 <-> 실행 사이클
인출 사이클(Fetch Cycle) : 메모리 내의 명령어를 CPU로 가지고 오는 단계
- 앞서 설명한 PC, MAR, MBR, IR을 활용한 메모리 - CPU 상호작용

실행 사이클(Execution Cycle) : CPU로 가져온 명령어를 실행하는 단계
- 인출 사이클을 통해 CPU로 가져온 명령어(IR에 저장된 명령어)를 해석하고, 해당 명령어에 맞는 제어 신호를 발생시킴
 
#### 간접 사이클
간접 사이클(Indirection) : 인출 사이클 직후 실행 사이클에 돌입하기 이위해 추가적인 메모리 접근이 필요한 경우 실행되는 사이클
- 가끔 바로 실행 사이클에 돌입할 수 없는 경우가 존재(메모리로부터 마로 CPU로 명령어를 가지고 올 수 없는 경우)
- ex. 간접 주소 지정 방식 : 추가적인 메모리 접근 필요

### 2. 인터럽트
인터럽트(Interrupt) : CPU 작업을 방해하는 신호
- CPU가 반드시 주목해야 하는 경우
- 또는 CPU가 더 빨리 처리해야 하는 다른 작업이 발생한 경우
- 인터럽트 발생 원인(부품)에 따라 동기 인터럽트와 비동기 인터럽트로 구분

#### 동기 인터럽트
동기 인터럽트(Synchronous Interrupt) : *CPU*에 의해 발생하는 인터럽트
- CPU가 명령어들을 실행하는 단계에서 예상치 못한 상황(ex. 프로그래밍 상 오류)이 발생한 경우 실행되는 인터럽트
- 예외(Exception)라고도 불림

#### 비동기 인터럽트
비동기 인터럽트(Asynchronous Interrupt) : *입출력장치*에 의해 발생하는 인터럽트
- 알림 역할
- 입출력장치에 명령어 전달 후 다른 명령어를 실행하는 동안, 해당 명령어를 받은 입출력장치가 실행을 끝낸 경우 발생
- CPU는 입출력장치에 명령어를 전달한 후, 비동기 인터럽트를 받는 동안 다른 명령어 수행 가능
- 하드웨어 인터럽트(Hardware Interrupt)라고도 불림

**<비동기 인터럽트 처리 순서>**
1. 입출력장치가 CPU에 인터럽트 요청 신호 전달
- CPU야 나 너가 시킨 일 끝냈어!
2. CPU는 실행 사이클 후 명령어 인출 전 인터럽트 여부를 항상 확인
- 내가 다른 입출력장치들에 시킨 일 중 끝난게 있나..?
3. 비동기 인터럽트 요청이 확인된 경우, 인터럽트 플래그를 통해 현재 인터럽트를 받아들일 수 있는지 확인
- 받아들일 수 있는 경우(인터럽트 플래그 값 = 1 or 막을 수 없는 인터럽트), CPU는 지금까지 하던 작업을 스택 영역에 백업 후, 해당 비동기 인터럽트 요청을 보낸 입출력장치로부터 데이터 버스를 통해 전달받은 인터럽트 벡터를 참조하여 인터럽트 서비스 루틴을 실행
    - 인터럽트 벡터(Interrupt Vector) : 어떤 인터럽트 서비스 루틴을 실행할 지 알려주는 인터럽트 서비스 루틴의 시작 메모리 주소
    - 인터럽트 서비스 루틴(Interrupt Service Routine, ISR) : 인터럽트 처리 프로그램
4. ISR 실행이 완료된 경우, 백업한 작업을 복구하여 실행 재개
- 백업한 내용은 스택 영역에 저장되어 있음 -> 해당 내용을 가져와서 재개

#### 결과
결과적으로 명령어 사이클은 다음과 같은 흐름으로 이루어진다

![명령어 사이클](<../images/Ch04/명령어 사이클.PNG>)
1. 기본적으로 인출 사이클과 실행 사이클을 반복한다
2. 인출 사이클 실행 후, 추가적인 메모리 접근이 필요한 경우 간접 사이클이 실행된다
3. 실행 사이클 실행 후, 다음 인출 사이클 진행 전 인터럽트 발생 여부를 확인한다. 만약, 인터럽트가 발생한 경우, 인터럽트 사이클을 실행한다.