# 컴퓨터구조
## Ch04. CPU 작동 원리
### 04-02. 레지스터

### 1. 레지스터
레지스터(Register) : CPU 내의 작은 임시 저장 장치
- CPU에서 메모리로 접근하는 것은 큰 연산을 불러일으킴
- CPU 내부에 작은 임시 저장 장치를 만들어 이를 활용
- 역할에 따라 이름이 달라짐

#### 레지스터의 종류
1. 프로그램 카운터(Program Counter, PC) : 메모리에서 가져올 명령어의 주소를 저장하는 레지스터
- 명령어 포인터(Instruction Pointer, IP)라고도 불림

2. 메모리 주소 레지스터(Memory Address Register, MAR) : 메모리의 주소를 저장하는 레지스터
- CPU가 읽어들이고자 하는 주소 값을 주소 버스를 통해 메모리에 전달하기 위해 거치는 레지스터

3. 메모리 버퍼 레지스터(Memory Buffer Register, MBR) : 메모리와 주고 받을 명령어와 데이터를 저장하는 레지스터
- CPU가 메모리와 주고 받으려 하는 데이터를 데이터 버스를 통해 주고받기 위해 거치는 레지스터
- 메모리 데이터 레지스터(Memory Data Register, MDR)라고도 불림

4. 명령어 레지스터(Instruction Register, IR) : 메모리에서 읽어들이고 해석하려는 명령어를 저장하는 레지스터
- 제어장치가 해석할 명령어를 받아들이기 위해 거치는 레지스터

5. 범용 레지스터(General Purpose Register) : 일반적인 상황에서 자유롭게 사용 가능한 레지스터
- 데이터, 주소 등 저장 가능
- CPU 내부에 여러 범용 레지스터가 존재

6. 플래그 레지스터(Flag Register) : ALU 연산 결과에 따른 플래그를 저장하는 레지스터
- 연산 결과, CPU 상태 등을 담은 플래그값을 얻기 위해 거치는 레지스터

7. 스택 포인터(Stack Pointer) : 스택의 꼭대기(Top)를 가리키는 레지스터
- 스택에 마지막으로 저장된 값의 위치를 저장하는 레지스터
- *스택 주소 지정 방식*에 사용되는 레지스터

8. 베이스 레지스터(Base Register) : 기준 주소를 저장하는 레지스터
- *베이스 레지스터 주소 지정 방식*에 사용되는 레지스터

#### 레지스터 활용
CPU에서 실행하려는 프로그램이 저장된 메모리 주소가 1000번지 ~ 1500번지라고 가정하자
- 현재 1000번지에 저장된 값은 0b1101이다.

1. 프로그램을 처음부터 실행
- 프로그램 카운터(PC)에 메모리에서 가져올 명령어 주소(1000번지) 저장
2. PC에 저장된 주소로부터 읽기
- 주소 버스를 통해 PC에 저장된 명령어 주소(1000번지)를 내보내야 함
- 이를 위해 명령어 레지스터(IR)에 해당 주소(1000번지)를 저장
3. 제어 신호 내보내기
- 시스템 버스를 활용하여 메모리로 내보내기
    - 제어 버스로 메모리 읽기 제어 신호를 전달
    - 주소 버스로 메모리 주소 레지스터(MAR)에 저장된 주소를 전달
- 메모리야, 나한테 1000번지에 저장된 값을 읽게 해 줘!
4. 제어 신호 받아들이기
- 시스템 버스를 활용하여 메모리로부터 받아들이기
    - 데이터 버스를 통해 1000번지에 저장된 값(0b1101)을 전달받음
    - 전달받은 데이터를 메모리 버퍼 레지스터(MBR)에 저장
- 데이터를 전달 받은 이후, PC에 저장된 값 증가(1000 -> 1001)
5. MBR에 저장된 값을 IR로 전달
- 현재 MBR에 저장된 값 : 데이터 버스를 통해 전달 받은 데이터(0b1101)
- 해당 값을 IR에 저장
6. IR에 저장된 명령어 해석
- 제어 장치는 IR에 저장된 명령어를 해석 -> 해석 결과에 따른 제어 신호 발생

#### 레지스터를 활용한 주소 지정 방식
앞서 설명한 주소 지정 방식
- 즉시 주소 지정 방식(데이터)
- 직접 주소 지정 방식(메모리 주소 - 데이터)
- 간접 주소 지정 방식(메모리 주소 - 메모리 주소 - 데이터)
- 레지스터 주소 지정 방식(레지스터 주소 - 데이터)
- 레지스터 간접 주소 지정 방식(레지스터 주소 - 메모리 주소 - 데이터)

스택 포인터와 베이스 레지스터를 활용하여 주소를 지정할 수 있다!

1. 스택 주소 지정 방식(Stack Addressing Mode) : 스택 포인터를 이용한 주소 지정 방식
- 메모리 영역 내에 암묵적으로 약속된 스택 영역이 존재
- 해당 영역에서 스택에 마지막으로 저장된 값의 위치(Top)을 스택 포인터에 저장
2. 변위 주소 지정 방식(Displacement Addressing Mode) : 오퍼랜드 필드에 저장된 값(= 변위)와 특정 레지스터에 저장된 값을 더하여 유효 주소를 얻는 주소 지정 방식
- 상대 주소 지정 방식 : 오퍼랜드와 프로그램 카운터에 저장된 값을 더하여 유효 주소를 얻는 방식
    - PC : 읽어들일 명령어 주소
    - OP : 읽어들일 명령어의 주소로부터 떨어진 거리
- 베이스 레지스터 주소 지정 방식 : 오퍼랜드와 베이스 레지스터에 저장된 값을 더하여 유효 주소를 얻는 방식
    - BR : 기준 주소
    - OP : 기준 주소로부터 떨어진 거리
