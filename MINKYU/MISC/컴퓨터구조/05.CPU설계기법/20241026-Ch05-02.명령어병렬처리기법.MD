# 컴퓨터구조
## Ch05. CPU 설계 기법
### 05-02. 명령어 병렬 처리 기법
출처 : [강민철 - 개발자를 위한 컴퓨터공학 1 : 혼자 공부하는 컴퓨터구조 + 운영체제](https://www.inflearn.com/course/%ED%98%BC%EC%9E%90-%EA%B3%B5%EB%B6%80%ED%95%98%EB%8A%94-%EC%BB%B4%ED%93%A8%ED%84%B0%EA%B5%AC%EC%A1%B0-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C)

### 0. 명령어 병렬 처리 기법
명령어 병렬 처리 기법(Instruction-Level Parallelism, ILP) : 명령어를 동시에 처리하여 CPU를 효율적으로 작동시키는 기법
- 빠른 CPU의 조건 : 높은 클럭 속도 + 멀티코어 + 멀티스레드
- 또한, CPU가 시간을 알뜰하게 쓰는 것이 중요!!
- 명령어 파이프라이닝, 슈퍼스칼라, 비순차적 명령어 처리

### 1. 명령어 파이프라이닝
하나의 명령어가 처리되는 과정(클럭 단위)
1. 명령어 인출(Instruction Fetch)
2. 명령어 해석(Instruction Decode)
3. 명령어 실행(Instruction Executation)
4. 결과 저장(Write Back)

**CPU는 겹치지 않는 각 단계를 동시에 실행 가능하다**
- ex. 명령어 A를 인출하는동안, 명령어 B를 실행할 수 있다

명령어 파이프라이닝(Instruction Pipelining) : 명령어들을 파이프라인에 넣고 동시에 처리하는 기법
- 모든 명령어를 순차적으로 처리하는 것 보다 효율적으로 시간 활용 가능
- 파이프라인 위험(Pipeline Hazard) 발생 가능 : 특정 상황에서 성능 향상에 실패
    - 데이터 위험
    - 제어 위험
    - 구조적 위험

#### 파이프라인 위험의 종류
1. 데이터 위험(Data Hazard) : 명령어 간 데이터 의존성에 의해 발생하는 파이프라인 위험
- 특정 명령어는 이전 명령어를 끝까지 실행해야 실행 가능한 경우가 존재한다
- 데이터 의존적인 두 명령어는 동시에 실행 불가능하다

2. 제어 위험(Control Hazard) : 분기 등으로 인한 프로그램 카운터에 저장된 값의 갑작스러운 변화에 의해 발생하는 파이프라인 위험
- 프로그램 카운터에 저장된 값 : 현재 실행 중인 명령어의 주소
    - 기본적으로 갱신 시 다음 주소로 갱신됨
    - 분기점을 통해 실행 흐름이 변화되는 경우, PC에 저장된 값이 갑작스럽게 변할 수 있음
    - 기존에 처리하던 명령어들이 쓸모가 없어지는 경우
- 이를 방지하기 위해 분기 예측 사용
    - 분기 예측(Branch Prediction) : 프로그램이 어디로 분기할 지 미리 예측하여 해당 주소를 인출하는 기법

3. 구조적 위험(Structural Hazard) : 서로 다른 명령어가 동시에 ALU, 레지스터 등 CPU 부품을 사용하려는 경우 발생하는 파이프라인 위험
- 자원 위험(Resource Hazard)라고도 불림

### 2. 슈퍼스칼라
슈퍼스칼라(SuperScalar) : 여러 개의 파이프라인을 이용하는 명령어 파이프라이닝 기법
- 슈퍼스칼라 CPU(슈퍼스칼라 프로세서) : 슈퍼스칼라 구조로 명령어 처리가 가능한 CPU
- 이론적으로 파이프라인 개수에 비례하여 프로그램 처리 속도가 증가
- 고도의 설계 기법을 요구
- 명령어 파이프라이닝에 비해 파이프라인 위험에 노출될 확률이 큼

### 3. 비순차적 명령어 처리
비순차적 명령어 처리(Out-of-Order Execution, OoOE) : 명령어들을 순차적으로 실행하지 않는 기법
- 명령어들의 합법적인 새치기
- 순차적 명령어 처리 기법 : 명령어 파이프라이닝, 슈퍼스칼라
- 데이터 의존성이 없는 명령어들을 먼저 처리 